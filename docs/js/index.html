<!DOCTYPE html>

<html>
<head>
  <title>Piecemaker 2 API client for Processing and plain Java, JS in the browser and node.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Piecemaker 2 API client for Processing and plain Java, JS in the browser and node.js</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This is the JavaScript version.</p>
<p>Created by fjenett 2012, 2013<br><a href="https://github.com/motionbank/piecemaker-api-client">https://github.com/motionbank/piecemaker-api-client</a></p>
<p>Parameters listed in square brackets are optional:</p>
<pre><code>api.someMethod( arg1 [, optionalArg2 ] )</code></pre>
<p>Because of the asynchronous nature of it all API client methods except 
for createCallback() do not return any values. Results are passed 
into an mostly optional callback instead.</p>
<p>See:<br><a href="http://motionbank.org/">http://motionbank.org/</a><br><a href="http://piecemaker.org/">http://piecemaker.org/</a></p>
<p>Version: 0.0.18<br>Build: 857</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="keyword">function</span>(){

	<span class="keyword">var</span> PieceMakerApi = (<span class="keyword">function</span>(ajaxImpl){</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>Class PieceMakerApi2</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Constructor versions:</p>
<pre><code>new PieceMakerApi( &lt;object&gt; context, &lt;string&gt; host [, &lt;string&gt; api_key ] )
new PieceMakerApi( &lt;object&gt; options )</code></pre>
<p>Where options object has:</p>
<pre><code>{  
  context : &lt;object&gt;,
  host :    &lt;string&gt;,
  api_key : &lt;string&gt; // optional
}</code></pre>
<p>If the api_key is not present you must use login() before being
able to issue any other calls to the API.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    <span class="keyword">var</span> _PieceMakerApi = <span class="function"><span class="keyword">function</span> <span class="params">( argContext, argHost, argApiKey )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Public fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="keyword">this</span>.host 	 = <span class="literal">undefined</span>;
	    	<span class="keyword">this</span>.api_key = <span class="literal">undefined</span>;
	    	<span class="keyword">this</span>.context = <span class="literal">undefined</span>;

	    	<span class="comment">/* parsing the parameters */</span>

			<span class="keyword">var</span> params = arguments[<span class="number">0</span>];
			
			<span class="keyword">if</span> ( arguments.length === <span class="number">1</span> &amp;&amp; <span class="keyword">typeof</span> params == <span class="string">'object'</span> ) {
		        <span class="keyword">this</span>.context 	= params.context || {};
				<span class="keyword">this</span>.api_key	= params.api_key || <span class="literal">false</span>;
				<span class="keyword">this</span>.host 		= params.host 	 || params.base_url || <span class="string">'http://localhost:3000'</span>;
			} <span class="keyword">else</span> {
				<span class="keyword">if</span> ( argContext &amp;&amp; <span class="keyword">typeof</span> argContext == <span class="string">'object'</span> ) {
					<span class="keyword">this</span>.context = argContext;
				}
				<span class="keyword">if</span> ( argHost &amp;&amp; <span class="keyword">typeof</span> argHost == <span class="string">'string'</span> ) {
					<span class="keyword">this</span>.host = argHost;
				}
				<span class="keyword">if</span> ( argApiKey &amp;&amp; <span class="keyword">typeof</span> argApiKey == <span class="string">'string'</span> ) {
					<span class="keyword">this</span>.api_key = argApiKey;
				}
			}

			<span class="keyword">this</span>.host += <span class="string">'/api/v1'</span>;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Static fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.TIMESPAN 	= <span class="string">"utc_timestamp"</span>;
		_PieceMakerApi.INTERSECTING = <span class="string">"intersect"</span>
		_PieceMakerApi.CONTAINED 	= <span class="string">"contain"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2>Users</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h3>Log a user in</h3>
<p>If the user has no API key, this will generate one</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/POST_api_version_user_login_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/POST_api_version_user_login_format</a></p>
<pre><code>api.login( &lt;string&gt; email, &lt;string&gt; password [, &lt;function&gt; callback ] )</code></pre>
<p>Callback returns API key as string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.login = <span class="function"><span class="keyword">function</span> <span class="params">( userEmail, userPassword, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, api = <span class="keyword">this</span>;
			<span class="keyword">if</span> ( !userEmail || !userPassword ) {
				<span class="keyword">throw</span>( <span class="string">"PieceMakerApi: need name and password to log user in"</span> );
			}
			<span class="keyword">var</span> self = <span class="keyword">this</span>;
		    xhrPost( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/user/login'</span>,
		        data: {
		        	email: userEmail,
		        	password: userPassword
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		        	<span class="keyword">var</span> api_key_new = <span class="literal">null</span>;
		        	<span class="keyword">if</span> ( response &amp;&amp; <span class="string">'api_access_key'</span> <span class="keyword">in</span> response &amp;&amp; response[<span class="string">'api_access_key'</span>] ) {
		        		self.api_key = response[<span class="string">'api_access_key'</span>];
		        		api_key_new = self.api_key;
		        	}
					callback.call( self.context || cb, api_key_new );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h3>Log a user out</h3>
<p>Does nothing at the moment, there is no more logging out</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/POST_api_version_user_logout_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/POST_api_version_user_logout_format</a></p>
<pre><code>api.logout( [ &lt;function&gt; callback ] )</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.logout = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop;
			callback.call( <span class="keyword">this</span>.context || cb, <span class="literal">null</span> );
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h3>Get all users</h3>
<p>Returns a list of all users</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/users/GET_api_version_users_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/users/GET_api_version_users_format</a></p>
<pre><code>api.listUsers( [ &lt;function&gt; callback ] )</code></pre>
<p>Callback receives array with all users</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.listUsers = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, api = <span class="keyword">this</span>;
			<span class="keyword">var</span> self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/users'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3>Get current user</h3>
<p>Returns the currently logged in user by looking up the active API key</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/GET_api_version_user_me_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/GET_api_version_user_me_format</a></p>
<pre><code>api.whoAmI( [ &lt;function&gt; callback ] )</code></pre>
<p>Callback receives current user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.whoAmI = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, api = <span class="keyword">this</span>;
			<span class="keyword">var</span> self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/user/me'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h3>Create a user</h3>
<p>Role id is optional, if none is provided it will be &quot;user&quot; (no permissions)</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/POST_api_version_user_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/POST_api_version_user_format</a></p>
<pre><code>api.createUser( &lt;string&gt; name, &lt;string&gt; email [, &lt;string&gt; role_id ] [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives new user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.createUser = <span class="function"><span class="keyword">function</span> <span class="params">( userName, userEmail, optionalUserRoleId, cb )</span> {</span>
			<span class="keyword">if</span> ( arguments.length === <span class="number">3</span> ) {
				cb = optionalUserRoleId;
				optionalUserRoleId = <span class="string">"user"</span>;
			}
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrPost( self, {
				url: self.host + <span class="string">'/user'</span>,
				data: {
					name: userName, 
					email: userEmail,
					user_role_id: optionalUserRoleId
				},
				success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
				}
			});
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h3>Get one user by id</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/GET_api_version_user_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/GET_api_version_user_id_format</a></p>
<pre><code>api.getUser( &lt;int&gt; user_id [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.getUser = <span class="function"><span class="keyword">function</span> <span class="params">( userId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/user/'</span> + userId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h3>Update a user</h3>
<p>Updating can change name, email or role_id and
it can disable a user and recreate a new password.</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/PUT_api_version_user_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/PUT_api_version_user_id_format</a></p>
<p>Versions:</p>
<pre><code>api.updateUser( &lt;int&gt; user_id, &lt;string&gt; name, &lt;string&gt; email, &lt;function&gt; callback )
api.updateUser( &lt;int&gt; user_id, &lt;string&gt; name, &lt;string&gt; email, &lt;boolean&gt; disable, &lt;boolean&gt; refresh_password, &lt;function&gt; callback )</code></pre>
<p>Callback receives updated user object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.updateUser = <span class="function"><span class="keyword">function</span> <span class="params">( userId, userName, userEmail, userRoleId_or_cb, 
														 userIsDisabled, userNewPassword, 
														 cb )</span> {</span>
			<span class="keyword">if</span> ( arguments.length === <span class="number">4</span> ) {
				cb = userRoleId_or_cb;
			} <span class="keyword">else</span> <span class="keyword">if</span> ( arguments.length !== <span class="number">7</span> ) {
				<span class="keyword">throw</span>( <span class="string">'Parameter exception: updateUser() expects 4 or 7 params'</span> );
			}
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			<span class="keyword">var</span> data = {
				name: userName, 
				email: userEmail
			};
			<span class="keyword">if</span> ( arguments.length === <span class="number">7</span> ) {
				<span class="keyword">if</span> ( userRoleId_or_cb )
					data.user_role_id = userRoleId_or_cb;
				data.is_disabled = userIsDisabled ? <span class="literal">true</span> : <span class="literal">false</span>;
				data.new_password = userNewPassword ? <span class="literal">true</span> : <span class="literal">false</span>;
			};
			xhrPut( self, {
				url: self.host + <span class="string">'/user/'</span> + userId,
				data: data,
				success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
				}
			}); 
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h3>Delete one user</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/user/DELETE_api_version_user_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/user/DELETE_api_version_user_id_format</a></p>
<pre><code>api.deleteUser( &lt;int&gt; user_id [, &lt;function&gt; callback ] )</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.deleteUser = <span class="function"><span class="keyword">function</span> <span class="params">( userId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrDelete( <span class="keyword">this</span>, {
				url: self.host + <span class="string">'/user/'</span> + userId,
				success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb <span class="comment">/*, response*/</span> );
				}
			});
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2>Groups</h2>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Groups are what Piecemaker 1 called a &quot;piece&quot;:<br>a collection of events (markers, videos, recordings, ...)</p>
<h3>Get all groups visible to current user</h3>
<p>This returns a list of groups that the user belongs to</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/groups/GET_api_version_groups_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/groups/GET_api_version_groups_format</a></p>
<pre><code>api.listGroups( &lt;function&gt; callback )</code></pre>
<p>Callback receives an array of group objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.listGroups = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/groups'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h3>Get all groups</h3>
<p>Get a list of all available groups</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/groups/GET_api_version_groups_all_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/groups/GET_api_version_groups_all_format</a></p>
<pre><code>api.listAllGroups( &lt;function&gt; callback )</code></pre>
<p>Callback receives an array of group objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.listAllGroups = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/groups/all'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h3>Create a group</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/POST_api_version_group_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/POST_api_version_group_format</a></p>
<pre><code>api.createGroup( &lt;string&gt; title, &lt;string&gt; description [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives new group object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.createGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupTitle, groupText, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop;
			<span class="keyword">var</span> self = <span class="keyword">this</span>;
			<span class="keyword">if</span> ( !groupTitle ) {
				<span class="keyword">throw</span>( <span class="string">"createGroup(): title can not be empty"</span> );
			}
			xhrPost( self, {
				url: self.host + <span class="string">'/group'</span>,
				data: {
					title: groupTitle,
					text: groupText || <span class="string">''</span>
				},
			    success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
			    }
			});
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h3>Get a group by id</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_format</a></p>
<pre><code>api.getGroup( &lt;int&gt; group_id [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives group object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.getGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h3>Update a group by id</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/PUT_api_version_group_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/PUT_api_version_group_id_format</a></p>
<pre><code>api.updateGroup( &lt;int&gt; group_id, &lt;object&gt; data [, &lt;function&gt; callback ] )</code></pre>
<p>where data is</p>
<pre><code>{
  title : &lt;string&gt;,
  text :  &lt;string&gt;
}</code></pre>
<p>Callback receives updated group object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.updateGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, groupData, cb )</span> {</span>
			<span class="keyword">var</span> data = convertData( groupData );
			<span class="keyword">var</span> callback = cb || noop;
			<span class="keyword">var</span> self = <span class="keyword">this</span>;
			xhrPut( self, {
				url: self.host + <span class="string">'/group/'</span>+groupId,
				data: data,
				success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
				}
			});
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h3>Delete a group</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/DELETE_api_version_group_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/DELETE_api_version_group_id_format</a></p>
<pre><code>api.deleteGroup( &lt;int&gt; group_id [, &lt;function&gt; callback ] )</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.deleteGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrDelete( <span class="keyword">this</span>, {
					url: self.host + <span class="string">'/group/'</span>+groupId,
					success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb <span class="comment">/*, response*/</span> );
				}
			});
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h3>Get all users in this group</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_users_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_users_format</a></p>
<pre><code>api.listGroupUsers( &lt;int&gt; group_id [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives an array of all users in that group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.listGroupUsers = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/users'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h3>Add a user to a group</h3>
<p>Expects a user role id to be given as which the user will act in the group</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/POST_api_version_group_event_group_id_user_user_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/POST_api_version_group_event_group_id_user_user_id_format</a></p>
<pre><code>api.addUserToGroup( &lt;int&gt; group_id, &lt;int&gt; user_id, &lt;string&gt; role_id [, &lt;function&gt; callback ] )</code></pre>
<p>Returns: TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.addUserToGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, userId, userRoleId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrPost( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/user/'</span>+userId,
		        data : {
		        	user_role_id : userRoleId
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h3>Change a users role in a group</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/PUT_api_version_group_event_group_id_user_user_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/PUT_api_version_group_event_group_id_user_user_id_format</a></p>
<pre><code>api.changeUserRoleInGroup( &lt;int&gt; group_id, &lt;int&gt; user_id, &lt;string&gt; role_id [, &lt;function&gt; callback ] )</code></pre>
<p>Returns: TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.changeUserRoleInGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, userId, userRoleId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrPut( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/user/'</span>+userId,
		        data : {
		        	user_role_id : userRoleId
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h3>Remove user from group</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/DELETE_api_version_group_event_group_id_user_user_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/DELETE_api_version_group_event_group_id_user_user_id_format</a></p>
<pre><code>api.removeUserFromGroup( &lt;int&gt; group_id, &lt;int&gt; user_id [, &lt;function&gt; callback ] )</code></pre>
<p>Returns: TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.removeUserFromGroup = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, userId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrDelete( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/user/'</span>+userId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2>Roles</h2>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>A role is a predefined set of permissions. Each user has a global role and 
roles per group that he/she is part of. Roles can inherit permissions from
other roles.</p>
<h3>List all available roles</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/roles/GET_api_version_roles_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/roles/GET_api_version_roles_format</a></p>
<pre><code>api.listRoles( [ &lt;function&gt; callback ] )</code></pre>
<p>Callback receives an array of all available roles</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.listRoles = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/roles'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h3>Add new role</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/POST_api_version_role_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/POST_api_version_role_format</a></p>
<pre><code>api.createRole( &lt;string&gt; role_id [, &lt;string&gt; inherit_role_id ] [, &lt;string&gt; description ] [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives new role created</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.createRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, optionalInheritRoleId, optionalText, cb )</span> {</span>
			<span class="keyword">if</span> ( arguments.length === <span class="number">2</span> ) {
				cb = optionalInheritRoleId;
				optionalInheritRoleId = <span class="literal">undefined</span>;
			} <span class="keyword">else</span> <span class="keyword">if</span> ( arguments.length === <span class="number">3</span> ) {
				cb = optionalText;
				optionalText = <span class="literal">undefined</span>;
			}
			
			<span class="keyword">var</span> data = { id: roleId };
			<span class="keyword">if</span> ( optionalInheritRoleId ) data.inherit_from_id = optionalInheritRoleId;
			<span class="keyword">if</span> ( optionalText ) data.text = optionalText;

			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrPost( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role'</span>,
		        data : data,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h3>Update role</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/PUT_api_version_role_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/PUT_api_version_role_id_format</a></p>
<pre><code>api.updateRole( &lt;string&gt; role_id, [, &lt;string&gt; inherit_role_id ] [, &lt;string&gt; description ] [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives updated role</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.updateRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, optionalInheritRoleId, optionalText, cb )</span> {</span>
			<span class="keyword">if</span> ( arguments.length === <span class="number">2</span> ) {
				cb = optionalInheritRoleId;
				optionalInheritRoleId = <span class="literal">undefined</span>;
			} <span class="keyword">else</span> <span class="keyword">if</span> ( arguments.length === <span class="number">3</span> ) {
				cb = optionalText;
				optionalText = <span class="literal">undefined</span>;
			}
			
			<span class="keyword">var</span> data = {};
			<span class="keyword">if</span> ( optionalInheritRoleId ) data.inherit_from_id = optionalInheritRoleId;
			<span class="keyword">if</span> ( optionalText ) data.text = optionalText;

			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrPut( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId,
		        data : data,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h3>Delete a role</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/DELETE_api_version_role_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/DELETE_api_version_role_id_format</a></p>
<pre><code>api.deleteRole( &lt;string&gt; role_id [, &lt;function&gt; callback ] )</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.deleteRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrDelete( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h3>Get a role by id</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/GET_api_version_role_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/GET_api_version_role_id_format</a></p>
<pre><code>api.getRole( &lt;string&gt; role_id [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives role</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.getRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
		    xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2>Role permissions</h2>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>A permission reflects a certain action on the server that can be triggered through the API.
Each permission can be set to &quot;allow&quot; or &quot;forbid&quot; one action.
Permissions are grouped into roles to allow for fine grained user rights control.</p>
<p>Permissions are predefined (hard coded) into the API, use listPermissions() to get a list.</p>
<h3>Get all permissions</h3>
<p>Only the permissions returned by this call are available</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/permissions/GET_api_version_permissions_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/permissions/GET_api_version_permissions_format</a></p>
<pre><code>api.listPermissions( [ &lt;function&gt; callback ] )</code></pre>
<p>Callback receives an array of permissions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.listPermissions = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/permissions'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h3>Add a permission to a role</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/POST_api_version_role_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/POST_api_version_role_format</a></p>
<pre><code>api.addPermissionToRole( &lt;string&gt; role_id, &lt;string&gt; permission [, &lt;string&gt; right ] [, &lt;function&gt; callback ] );</code></pre>
<p>&quot;permission&quot; as available through listPermissions()
&quot;right&quot; can be one of &quot;allow&quot; or &quot;forbid&quot;</p>
<p>Returns: TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.addPermissionToRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, permission, optionalRight_or_cb, cb )</span> {</span>
			<span class="keyword">if</span> ( arguments.length === <span class="number">3</span> ) {
				cb = optionalRight_or_cb;
			}
			<span class="keyword">if</span> ( arguments.length == <span class="number">2</span> ) {
				optionalRight_or_cb = <span class="string">'allow'</span>;
			}
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrPost( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId + <span class="string">'/permission'</span>,
		        data : {
		        	entity : permission,
		        	permission : optionalRight_or_cb
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h3>Change a role permission</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/PUT_api_version_role_user_role_id_permission_role_permission_entity_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/PUT_api_version_role_user_role_id_permission_role_permission_entity_format</a></p>
<pre><code>api.changePermissionForRole( &lt;string&gt; role_id, &lt;string&gt; permission, &lt;string&gt; right [, &lt;function&gt; callback ] )</code></pre>
<p>&quot;permission&quot; as available through listPermissions()
&quot;right&quot; can be one of &quot;allow&quot; or &quot;forbid&quot;</p>
<p>Returns: TODO</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.changePermissionForRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, permission, right, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrPut( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId + <span class="string">'/permission/'</span> + permission,
		        data : {
		        	permission : right
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h3>Remove a permission from a role</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/DELETE_api_version_role_user_role_id_permission_role_permission_entity_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/DELETE_api_version_role_user_role_id_permission_role_permission_entity_format</a></p>
<pre><code>api.removePermissionFromRole( &lt;string&gt; role_id, &lt;string&gt; permission [, &lt;function&gt; callback ] )</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.removePermissionFromRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, permission, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrDelete( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId + <span class="string">'/permission/'</span> + permission,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h3>Get a role permission</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/role/GET_api_version_role_user_role_id_permission_role_permission_entity_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/role/GET_api_version_role_user_role_id_permission_role_permission_entity_format</a></p>
<pre><code>api.getPermissionFromRole( &lt;string&gt; role_id, &lt;string&gt; permission [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives permission</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.getPermissionFromRole = <span class="function"><span class="keyword">function</span> <span class="params">( roleId, permission, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/role/'</span> + roleId + <span class="string">'/permission/'</span> + permission,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, response );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h2>Events</h2>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Anything on a timeline is an event in Piecemaker. That includes videos, data, annotations, ...</p>
<p>A bare event is a point in time (utc_timestamp), a duration in seconds and a type. 
Each event can have an undefined amount of additional fields in the form of {key:value}.</p>

            </div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h3>Get all events from a group</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format</a></p>
<pre><code>api.listEvents( &lt;int&gt; group_id [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives an array with all events in the group</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.listEvents = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/events'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, fixEventsResponseToArr( response ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h3>Get all events of a certain type</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format</a></p>
<pre><code>api.listEventsOfType( &lt;int&gt; group_id, &lt;string&gt; type [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives an array of events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.listEventsOfType = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, type, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/events'</span>,
		        data: {
		        	type: type
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
					callback.call( self.context || cb, fixEventsResponseToArr( response ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h3>Get all events that have certain fields (id and value must match)</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format</a></p>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Versions:</p>
<pre><code>api.listEventsOfType( &lt;int&gt; group_id [, &lt;string&gt; key1, &lt;string&gt; value1, ... ] [, &lt;function&gt; callback ] )</code></pre>
<p>This version is a vararg and takes any amount of key-value pair parameters.</p>
<pre><code>api.listEventsOfType( &lt;int&gt; group_id [, &lt;object&gt; fields ] [, &lt;function&gt; callback ] )</code></pre>
<p>This version assumes the second parameter to be an object with key-values:</p>
<pre><code>{
   key1 : value1,
   key2 : value2,
   ...
}</code></pre>
<p>Callback receives an array of events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.listEventsWithFields = <span class="function"><span class="keyword">function</span> <span class="params">( <span class="comment">/* groupId, id1, val1, id2, val2, , cb */</span> )</span> {</span>
			<span class="keyword">var</span> groupId = arguments[<span class="number">0</span>];
			<span class="keyword">var</span> fields = {};
			<span class="keyword">if</span> ( arguments.length &gt; <span class="number">3</span> ) {
				<span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">1</span>; i &lt; arguments.length-<span class="number">1</span>; i+=<span class="number">2</span> ) {
					fields[arguments[i]] = arguments[i+<span class="number">1</span>];
				}
			} <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="keyword">typeof</span> arguments[<span class="number">1</span>] === <span class="string">'object'</span> ) {
				<span class="keyword">for</span> ( <span class="keyword">var</span> k <span class="keyword">in</span> arguments[<span class="number">1</span>] ) {
					<span class="keyword">if</span> ( arguments[<span class="number">1</span>].hasOwnProperty(k) ) fields[k] = arguments[<span class="number">1</span>][k];
				}
			} <span class="keyword">else</span> {
				<span class="keyword">throw</span>( <span class="string">'Wrong parameter count'</span> );
			}
			<span class="keyword">var</span> cb = arguments[arguments.length-<span class="number">1</span>];
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( self, {
		        url: self.host + <span class="string">'/group/'</span> + groupId + <span class="string">'/events'</span>,
		        data: {
		        	fields: fields
		        },
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		        	callback.call( self.context || cb, fixEventsResponseToArr( response ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h3>Get all events that happened within given timeframe</h3>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format</a></p>
<p>Versions:</p>
<pre><code>api.listEventsForTimespan( &lt;int&gt; group_id, &lt;date&gt; from [, &lt;string&gt; method ] [, &lt;function&gt; callback ] )
api.listEventsForTimespan( &lt;int&gt; group_id, &lt;date&gt; to [, &lt;string&gt; method ] [, &lt;function&gt; callback ] )
api.listEventsForTimespan( &lt;int&gt; group_id, &lt;date&gt; from, &lt;date&gt; to [, &lt;string&gt; method ] [, &lt;function&gt; callback ] )</code></pre>
<p>If either <em>to</em> or <em>from</em> are null it is like saying <em>before to</em> or <em>after from</em>.</p>
<p>The <em>method</em> parameter is optional, can be any of:</p>
<pre><code>&#39;utc_timestamp&#39;, looking only at the start points
&#39;intersect&#39;, returning events that intersect the given time span or are contained within
&#39;contain&#39;, returning events that are fully contained (start+duration) in time span</code></pre>
<p>See here for details:
<a href="https://github.com/motionbank/piecemaker2-api/issues/76#issuecomment-37030586">https://github.com/motionbank/piecemaker2-api/issues/76#issuecomment-37030586</a></p>
<p>Callback receives an array of events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.listEventsForTimespan = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, from, to, method, cb )</span> {</span>
			<span class="keyword">if</span> ( arguments.length === <span class="number">4</span> ) cb = method;
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			<span class="keyword">var</span> data = {
	        	from: (from !== <span class="literal">null</span> ? jsDateToTs(from) : <span class="literal">null</span>),
	        	to:   (to   !== <span class="literal">null</span> ? jsDateToTs(to)   : <span class="literal">null</span>)
	        };
	        <span class="keyword">if</span> ( arguments.length === <span class="number">5</span> &amp;&amp; method !== <span class="literal">null</span> ) {
	        	method = method.toLowerCase();
	        	<span class="keyword">if</span> ( [<span class="string">'utc_timestamp'</span>,<span class="string">'intersect'</span>,<span class="string">'contain'</span>].indexOf(method) === -<span class="number">1</span> ) method = <span class="string">'intersect'</span>;
	        	data.fromto_query = method;
	        }
			xhrGet( self, {
		        url: self.host + <span class="string">'/group/'</span>+groupId+<span class="string">'/events'</span>,
		        data: data,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		        	callback.call( self.context || cb, fixEventsResponseToArr( response ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h3>Get all events that match</h3>
<p>This is a very generic method that allows for more complex searches</p>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/GET_api_version_group_id_events_format</a></p>
<pre><code>api.findEvents( &lt;int&gt; group_id, &lt;object&gt; query [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives an array of events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.findEvents = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, eventData, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( self, {
		        url: self.host + <span class="string">'/group/'</span> + groupId + <span class="string">'/events'</span>,
		        data: convertData( eventData ),
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		        	callback.call( self.context || cb, fixEventsResponseToArr( response ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h3>Get one event by id</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/event/GET_api_version_event_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/event/GET_api_version_event_id_format</a></p>
<pre><code>api.getEvent( &lt;int&gt; group_id, &lt;int&gt; event_id [, &lt;function&gt; callback ] )</code></pre>
<p>Callback receives one event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		
		_PieceMakerApi.prototype.getEvent = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, eventId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( self, {
		        url: self.host + <span class="string">'/event/'</span>+eventId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		        	callback.call( self.context || cb, expandEventToObject( fixEventResponse( response ) ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h3>Create one event</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/group/POST_api_version_group_id_event_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/group/POST_api_version_group_id_event_format</a></p>
<pre><code>api.createEvent( &lt;int&gt; group_id, &lt;object&gt; event_data [, &lt;function&gt; callback ] )</code></pre>
<p>Where <em>event_data</em> is:</p>
<pre><code>{
   utc_timestamp: &lt;date&gt;,
   duration:      &lt;int&gt;,
   type:          &lt;string&gt;,
  // optionally:
   fields: {
       key1 : value1,
       key2 : value2,
       ...
    } 
}</code></pre>
<p>Callback receives newly created event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.createEvent = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, eventData, cb )</span> {</span>
			<span class="keyword">var</span> data = convertData( eventData );
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrPost( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/group/'</span> + groupId + <span class="string">'/event'</span>,
		        data: data,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		        	callback.call( self.context || cb, expandEventToObject( fixEventResponse( response ) ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h3>Update one event</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/event/PUT_api_version_event_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/event/PUT_api_version_event_id_format</a></p>
<pre><code>api.updateEvent( &lt;int&gt; group_id, &lt;int&gt; event_id, &lt;object&gt; event_data [, &lt;function&gt; callback ] )</code></pre>
<p>Where <em>event_data</em> is:</p>
<pre><code>{
   utc_timestamp: &lt;date&gt;,
   duration:      &lt;int&gt;,
   type:          &lt;string&gt;,
  // optionally:
   fields: {
       key1 : value1,
       key2 : value2,
       ...
    } 
}</code></pre>
<p>Callback receives updated event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.updateEvent = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, eventId, eventData, cb )</span> {</span>
			<span class="keyword">var</span> data = convertData( eventData );
			data[<span class="string">'event_group_id'</span>] = groupId;
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrPut( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/event/'</span> + eventId,
		        data: data,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		            callback.call( self.context || cb, expandEventToObject( fixEventResponse( response ) ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h3>Delete one event</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/event/DELETE_api_version_event_id_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/event/DELETE_api_version_event_id_format</a></p>
<pre><code>api.deleteEvent( &lt;int&gt; group_id, &lt;int&gt; event_id [, &lt;function&gt; callback ] )</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.deleteEvent = <span class="function"><span class="keyword">function</span> <span class="params">( groupId, eventId, cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			<span class="keyword">if</span> ( (<span class="keyword">typeof</span> eventId === <span class="string">'object'</span>) &amp;&amp; (<span class="string">'id'</span> <span class="keyword">in</span> eventId) ) eventId = eventId.id;
			xhrDelete( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/event/'</span> + eventId,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		            callback.call( self.context || cb , expandEventToObject( fixEventResponse( response ) ) );
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2>System related calls</h2>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <h3>Get the system (server) time</h3>
<p>See:
<a href="http://motionbank.github.io/piecemaker2-api/swagger/#!/system/GET_api_version_system_utc_timestamp_format">http://motionbank.github.io/piecemaker2-api/swagger/#!/system/GET_api_version_system_utc_timestamp_format</a></p>
<pre><code>api.getSystemTime( [ &lt;function&gt; callback ] )</code></pre>
<p>Callback receives UTC timestamp (date) of server</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.getSystemTime = <span class="function"><span class="keyword">function</span> <span class="params">( cb )</span> {</span>
			<span class="keyword">var</span> callback = cb || noop, self = <span class="keyword">this</span>;
			xhrGet( <span class="keyword">this</span>, {
		        url: self.host + <span class="string">'/system/utc_timestamp'</span>,
		        success: <span class="function"><span class="keyword">function</span> <span class="params">( response )</span> {</span>
		            callback.call( self.context || cb, <span class="keyword">new</span> Date( response.utc_timestamp * <span class="number">1000</span> ));
		        }
		    });
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h2>Additional client methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap for-h3">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h3>Create a callback to be used for the API calls</h3>
<p>This method mainly serves to legalize the Processing / Java syntax. 
In plain JavaScript just pass a function as callback into the API client methods.</p>
<p>Versions:</p>
<pre><code>api.createCallback( &lt;string&gt; method_name )
api.createCallback( &lt;object&gt; context, &lt;string&gt; method_name )</code></pre>

            </div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Returns a function or callable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_PieceMakerApi.prototype.createCallback = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>

			<span class="keyword">var</span> self = <span class="keyword">this</span>;

			<span class="keyword">if</span> ( arguments.length === <span class="number">1</span> ) {

				<span class="keyword">return</span> self.context[arguments[<span class="number">0</span>]];

			} <span class="keyword">else</span> <span class="keyword">if</span> ( arguments.length &gt;= <span class="number">2</span> ) {
				
				<span class="keyword">var</span> more = <span class="number">1</span>;
				<span class="keyword">var</span> cntx = self.context, meth = arguments[<span class="number">0</span>];
				
				<span class="keyword">if</span> ( <span class="keyword">typeof</span> arguments[<span class="number">0</span>] !== <span class="string">'string'</span> ) { <span class="comment">// then it's not a method name</span>
					cntx = arguments[<span class="number">0</span>];
					<span class="keyword">if</span> ( <span class="keyword">typeof</span> arguments[<span class="number">1</span>] !== <span class="string">'string'</span> ) {
						<span class="keyword">throw</span>( <span class="string">'createCallback(): if first argument is a target then the second needs to be a method name'</span> );
					}
					meth = arguments[<span class="number">1</span>];
					more = <span class="number">2</span>;
				}

				<span class="keyword">if</span> ( arguments.length &gt; more ) {
					<span class="keyword">var</span> args = [];
					<span class="keyword">for</span> ( <span class="keyword">var</span> i = more; i &lt; arguments.length; i++ ) {
						args.push( arguments[i] );
					}	
					<span class="keyword">return</span> (<span class="keyword">function</span>(c,m,a){
						<span class="keyword">return</span> <span class="keyword">function</span>(response) {
							<span class="keyword">if</span> (response) a.unshift(response);
							c[m].apply( c, a );
						}
					})(cntx, meth, args);
				}
				<span class="keyword">else</span> 
					<span class="keyword">return</span> cntx[meth];
			}
			<span class="keyword">else</span>
				<span class="keyword">throw</span>( <span class="string">"createCallback(): wrong number of arguments"</span> );
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h2>Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>... just an empty function to use in place of missing callbacks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    <span class="keyword">var</span> noop = <span class="keyword">function</span>(){};</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Convert Processing.js HashMaps to JavaScript objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    <span class="keyword">var</span> convertData = <span class="function"><span class="keyword">function</span> <span class="params">( data )</span> {</span>
	    	<span class="keyword">if</span> ( !data ) <span class="keyword">return</span> data;
	    	<span class="keyword">if</span> ( <span class="keyword">typeof</span> data !== <span class="string">'object'</span> ) <span class="keyword">return</span> data;
	    	<span class="keyword">if</span> ( <span class="string">'entrySet'</span> <span class="keyword">in</span> data &amp;&amp; <span class="keyword">typeof</span> data.entrySet === <span class="string">'function'</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>var allowed_long_keys = [&#39;utc_timestamp&#39;, &#39;duration&#39;, &#39;type&#39;, &#39;token&#39;];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    		<span class="keyword">var</span> set = data.entrySet();
	    		<span class="keyword">if</span> ( !set ) <span class="keyword">return</span> data;
	    		<span class="keyword">var</span> obj = {};
	    		<span class="keyword">var</span> iter = set.iterator();
	    		<span class="keyword">while</span> ( iter.hasNext() ) {
					<span class="keyword">var</span> entry = iter.next();
					<span class="keyword">var</span> val = entry.getValue();
					<span class="keyword">if</span> ( val &amp;&amp; <span class="keyword">typeof</span> val === <span class="string">'object'</span> &amp;&amp; 
						 <span class="string">'entrySet'</span> <span class="keyword">in</span> val &amp;&amp; 
						 <span class="keyword">typeof</span> val.entrySet === <span class="string">'function'</span> ) val = convertData(val);
					<span class="keyword">var</span> key = entry.getKey();
					<span class="keyword">if</span> ( !key ) {
						<span class="keyword">throw</span>( <span class="string">"Field key is not valid: "</span> + key );
					}
					obj[entry.getKey()] = val;
				}
				<span class="keyword">return</span> obj;
	    	} <span class="keyword">else</span> {
	    		<span class="keyword">if</span> ( <span class="string">'utc_timestamp'</span> <span class="keyword">in</span> data ) data.utc_timestamp = jsDateToTs(data.utc_timestamp);
	    		<span class="keyword">if</span> ( <span class="string">'created_at'</span> <span class="keyword">in</span> data )    data.created_at 	  = jsDateToTs(data.created_at);
	    	}
	    	<span class="keyword">return</span> data;
	    }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>temporary fix for:
<a href="https://github.com/motionbank/piecemaker2/issues/54">https://github.com/motionbank/piecemaker2/issues/54</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    <span class="keyword">var</span> fixEventsResponseToArr = <span class="function"><span class="keyword">function</span> <span class="params">( resp )</span> {</span>
	    	<span class="keyword">if</span> ( resp <span class="keyword">instanceof</span> Array ) {
	    		<span class="keyword">var</span> arr = [];
	    		<span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>; i &lt; resp.length; i++ ) {
	    			arr.push( expandEventToObject( fixEventResponse( resp[i] ) ) );
	    		}
	    		<span class="keyword">return</span> arr;
	    	}
	    	<span class="keyword">return</span> resp;
	    }

	    <span class="keyword">var</span> fixEventResponse = <span class="function"><span class="keyword">function</span> <span class="params">( resp )</span> {</span>
	    	<span class="keyword">var</span> eventObj = resp[<span class="string">'event'</span>];
	    	eventObj[<span class="string">'fields'</span>] = {};
	    	<span class="keyword">for</span> ( <span class="keyword">var</span> i = <span class="number">0</span>, fields = resp[<span class="string">'fields'</span>]; i &lt; fields.length; i++ ) {
	    		eventObj[<span class="string">'fields'</span>][fields[i][<span class="string">'id'</span>]] = fields[i][<span class="string">'value'</span>];
	    	}
	    	<span class="keyword">return</span> eventObj;
	    }

	    <span class="keyword">var</span> expandEventToObject = <span class="function"><span class="keyword">function</span> <span class="params">( event )</span> {</span>
	    	event.fields.get = (<span class="keyword">function</span>(e){
	    		<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">( k )</span> {</span>
	    			<span class="keyword">return</span> e.fields[k];
	    		}
	    	})(event);
	    	event.utc_timestamp = <span class="keyword">new</span> Date( event.utc_timestamp * <span class="number">1000.0</span> );
	    	<span class="keyword">return</span> event;
	    }

	    <span class="keyword">var</span> jsDateToTs = <span class="function"><span class="keyword">function</span> <span class="params">( date_time )</span> {</span>
	    	<span class="keyword">if</span> ( date_time <span class="keyword">instanceof</span> Date ) {
	    		<span class="keyword">return</span> date_time.getTime() / <span class="number">1000.0</span>;
	    	} <span class="keyword">else</span> {
	    		<span class="keyword">if</span> ( date_time &gt; <span class="number">9999999999</span> ) {
	    			<span class="keyword">return</span> date_time / <span class="number">1000.0</span>; <span class="comment">// assume it's a JS timestamp in ms</span>
	    		} <span class="keyword">else</span> {
	    			<span class="keyword">return</span> date_time; <span class="comment">// assume it's ok</span>
	    		}
	    	}
	    }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <h2>XHR requests</h2>

            </div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="comment">/* cross origin resource sharing
		   http://www.html5rocks.com/en/tutorials/cors/ */</span>
		
	    <span class="keyword">var</span> xhrRequest = <span class="function"><span class="keyword">function</span> <span class="params">( pm, url, type, data, success )</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Almost all calls to the API need to be done including a per-user API token.
This token is passed into the constructor below and gets automatically 
added to each call here if it is not already present.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	    	<span class="keyword">if</span> ( !pm.api_key &amp;&amp; !url.match(<span class="regexp">/\/user\/login$/</span>) ) {
	    		<span class="keyword">throw</span>( <span class="string">"PieceMakerApi: need an API_KEY, please login first to obtain one"</span> );
	    	}

	    	<span class="keyword">var</span> ts = (<span class="keyword">new</span> Date()).getTime();
	    	<span class="keyword">var</span> callUrl = url + <span class="string">'.json'</span>;

	        ajaxImpl({
	                url: callUrl,
	                type: type,
	                dataType: <span class="string">'json'</span>,
	                data: data || {},</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>before: function ( xhr ) {
    if ( !url.match(/\/user\/login$/) ) {
        xhr.setRequestHeader( &#39;X-Access-Key&#39;, api.api_key );
    }
},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					context: pm,
	                success: <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
	                	<span class="keyword">if</span> ( arguments &amp;&amp; arguments[<span class="number">0</span>] &amp;&amp; 
	                		 <span class="keyword">typeof</span> arguments[<span class="number">0</span>] === <span class="string">'object'</span> &amp;&amp; 
	                		 !(arguments[<span class="number">0</span>] <span class="keyword">instanceof</span> Array) &amp;&amp; 
	                		 !(<span class="string">'queryTime'</span> <span class="keyword">in</span> arguments[<span class="number">0</span>]) ) {
	                		arguments[<span class="number">0</span>][<span class="string">'queryTime'</span>] = ((<span class="keyword">new</span> Date()).getTime()) - ts;
	                	}
	                	success.apply( pm, arguments );
	                },
	                error: <span class="function"><span class="keyword">function</span> <span class="params">(err)</span> {</span>
	                    xhrError( pm, callUrl, type, err );
	                },
	                <span class="comment">/* , xhrFields: { withCredentials: true } */</span>
					<span class="comment">/* , headers: { 'Cookie' : document.cookie } */</span>
					headers: {
						<span class="string">'X-Access-Key'</span>: pm.api_key
					}
	            });
	    };

		<span class="keyword">var</span> xhrGet = <span class="function"><span class="keyword">function</span> <span class="params">( pm, opts )</span> {</span>
			xhrRequest( pm, opts.url, <span class="string">'get'</span>, opts.data, opts.success );
		}

		<span class="keyword">var</span> xhrPut = <span class="function"><span class="keyword">function</span> <span class="params">( pm, opts )</span> {</span>
		    xhrRequest( pm, opts.url, <span class="string">'put'</span>, opts.data, opts.success );
		}

		<span class="keyword">var</span> xhrPost = <span class="function"><span class="keyword">function</span> <span class="params">( pm, opts )</span> {</span>
		    xhrRequest( pm, opts.url, <span class="string">'post'</span>, opts.data, opts.success );
		}

		<span class="keyword">var</span> xhrDelete = <span class="function"><span class="keyword">function</span> <span class="params">( pm, opts )</span> {</span>
		    xhrRequest( pm, opts.url, <span class="string">'delete'</span>, <span class="literal">null</span>, opts.success );
		}
		
		<span class="keyword">var</span> xhrError = <span class="function"><span class="keyword">function</span> <span class="params">( pm, url, type, err )</span> {</span>

			<span class="keyword">var</span> statusCode = -<span class="number">1</span>, statusMessage = <span class="string">""</span>;

			<span class="keyword">if</span> ( err ) {
				statusCode = err.status || err.statusCode;
				statusMessage = err.statusText || err.message || <span class="string">'No error message'</span>;
				<span class="keyword">if</span> ( err.responseText ) {
					statusMessage += <span class="string">" "</span> + err.responseText;
				}
			}

			<span class="keyword">if</span> ( pm &amp;&amp; <span class="string">'piecemakerError'</span> <span class="keyword">in</span> pm &amp;&amp; <span class="keyword">typeof</span> pm[<span class="string">'piecemakerError'</span>] == <span class="string">'function'</span> )
				pm[<span class="string">'piecemakerError'</span>]( statusCode, statusMessage, type.toUpperCase() + <span class="string">" "</span> + url );
			<span class="keyword">else</span> {
				<span class="keyword">if</span> ( <span class="keyword">typeof</span> console !== <span class="string">'undefined'</span> &amp;&amp; console.log ) {
					console.log( statusCode, statusMessage, url, type, err );
				}
				<span class="keyword">throw</span>( err );
			}
		}

	    <span class="keyword">return</span> _PieceMakerApi;
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h2>Environment setup</h2>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>... Node or browser window</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="keyword">if</span> ( <span class="keyword">typeof</span> module !== <span class="string">'undefined'</span> &amp;&amp; module.exports ) {

		<span class="keyword">var</span> nodeAjax = <span class="function"><span class="keyword">function</span> <span class="title">noop</span> <span class="params">()</span> {</span>
			<span class="keyword">throw</span>(<span class="string">'Seems like you are running in neither a browser nor Node. Can\'t help you there.'</span>);
		};

		<span class="keyword">if</span> ( <span class="keyword">typeof</span> global !== <span class="string">'undefined'</span> ) { <span class="comment">// check if environment could be Node</span>

			<span class="keyword">var</span> url = require(<span class="string">'url'</span>), 
				qstr = require(<span class="string">'querystring'</span>),
				http = require(<span class="string">'http'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>a shim to mimic jQuery.ajax for node.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			nodeAjax = <span class="function"><span class="keyword">function</span> <span class="title">nodeAjax</span> <span class="params">(opts)</span> {</span>

				<span class="keyword">var</span> url_parsed = url.parse(opts.url);
				<span class="keyword">var</span> data = JSON.stringify( opts.data );

				<span class="keyword">var</span> headers = opts.headers || {};
				headers[<span class="string">'Content-Type'</span>] = <span class="string">'application/json'</span>;
				
				<span class="keyword">var</span> query = <span class="literal">null</span>;

				<span class="keyword">if</span> ( opts.type !== <span class="string">'get'</span> ) {
		    		headers[<span class="string">'Content-Length'</span>] = Buffer.byteLength( data, <span class="string">'utf-8'</span> );
		 		} <span class="keyword">else</span> {
		 			<span class="keyword">var</span> opts_data = opts.data || {};
		 			<span class="keyword">for</span> ( <span class="keyword">var</span> k <span class="keyword">in</span> opts_data ) {
		 				<span class="keyword">if</span> ( opts_data.hasOwnProperty(k) &amp;&amp; <span class="keyword">typeof</span> opts_data[k] === <span class="string">'object'</span> ) {
		 					<span class="keyword">var</span> subObj = opts_data[k];
		 					<span class="keyword">for</span> ( <span class="keyword">var</span> kk <span class="keyword">in</span> subObj ) {
		 						opts_data[k+<span class="string">'['</span>+kk+<span class="string">']'</span>] = subObj[kk];
		 					}
		 					<span class="keyword">delete</span> opts_data[k];
		 				}
		 			}
		 			query = qstr.stringify( opts_data );
		 		}
		 
				<span class="keyword">var</span> req_options = {
				    host 	: url_parsed.hostname,
				    port 	: url_parsed.port || <span class="number">80</span>,
				    path 	: url_parsed.path + ((opts.type === <span class="string">'get'</span> &amp;&amp; query) ? <span class="string">'?'</span> + query : <span class="string">''</span>),
				    method  : opts.type,
				    headers : headers
				};

				<span class="keyword">var</span> request = http.request( req_options, <span class="keyword">function</span>(res) {

				    <span class="keyword">if</span> ( !(res.statusCode === <span class="number">302</span> || res.statusCode &lt;= <span class="number">300</span>) ) {
				    	opts.error.apply(<span class="literal">null</span>,[res]);
				    	<span class="keyword">return</span>;
				    }

				 	<span class="keyword">var</span> buf = <span class="string">''</span>;
				    res.on( <span class="string">'data'</span>, <span class="keyword">function</span>(d) {
				        buf += d;
				    });
				    res.on( <span class="string">'end'</span>, <span class="keyword">function</span>() {
				    	opts.success.apply(opts.context,[JSON.parse(buf)]);
				    });
				});

				request.on(<span class="string">'error'</span>, <span class="keyword">function</span>(e) {
				    <span class="keyword">if</span> ( opts.error ) opts.error.apply(<span class="literal">null</span>,[e]);
				});
		 
		 		<span class="keyword">if</span> ( opts.type !== <span class="string">'get'</span> ) {
					request.write( data );
		 		}

				request.end();
			}
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>support common-js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		module.exports = PieceMakerApi(nodeAjax);

	} <span class="keyword">else</span> <span class="keyword">if</span> ( window &amp;&amp; !(<span class="string">'PieceMakerApi'</span> <span class="keyword">in</span> window) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>in the browsers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		window.PieceMakerApi = PieceMakerApi($.ajax);
	}

})();</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
